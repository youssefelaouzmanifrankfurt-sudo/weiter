<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scanner Terminal</title>
    
    <link rel="stylesheet" href="/css/nav.css">
    <link rel="stylesheet" href="/css/lager.css">
    <link rel="stylesheet" href="/css/lager_styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

    <style>
        body { background: #000000; color: white; } /* Full Black Mode f√ºr Battery Save */
        .main-content { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        #reader-container { 
            width:100%; height:300px; background:#111; border-radius:15px; 
            overflow:hidden; margin-bottom:20px; border:2px solid #334155; 
            position:relative;
        }

        .mode-grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px; }
        .mode-btn { 
            padding:20px; background:#1e293b; border:1px solid #334155;
            color:#94a3b8; border-radius:10px; cursor:pointer; 
            display:flex; flex-direction:column; align-items:center; gap:8px; 
        }
        .mode-btn.active { 
            background:#0f172a; border-color:#3b82f6; color:white; 
            box-shadow: 0 0 15px rgba(59,130,246,0.3);
        }
        
        .result-card {
            background: #1e293b; padding: 15px; border-radius: 8px; margin-top: 10px;
            border-left: 5px solid #3b82f6; animation: slideIn 0.3s;
        }
        @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    </style>
</head>
<body>

    <%- include('partials/nav') %>

    <div class="main-content">
        <div id="reader-container"></div>
        
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="text" id="terminal-input" placeholder="Barcode tippen..." 
                   style="flex:1; padding:15px; background:#1e293b; border:none; color:white; border-radius:8px;">
            <button onclick="window.ScanCtrl.triggerManual()" style="background:#3b82f6; color:white; border:none; width:60px; border-radius:8px;">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <button onclick="window.ScanCtrl.triggerOCR()" style="width:100%; padding:12px; background:#334155; color:white; border:none; border-radius:8px; margin-bottom:20px;">
            <i class="fas fa-camera"></i> Foto-Scan (OCR)
        </button>
        <input type="file" id="global-cam-input" accept="image/*" capture="environment" style="display:none;">

        <div class="mode-grid">
            <button id="mode-search" class="mode-btn active" onclick="window.ScanCtrl.setMode('search')">
                <i class="fas fa-info-circle fa-2x"></i> Info
            </button>
            <button id="mode-sell" class="mode-btn" onclick="window.ScanCtrl.setMode('sell')">
                <i class="fas fa-shopping-cart fa-2x" style="color:#ef4444;"></i> Verkauf
            </button>
            <button id="mode-inventory" class="mode-btn" onclick="window.ScanCtrl.setMode('inventory')">
                <i class="fas fa-check-double fa-2x" style="color:#10b981;"></i> Inventur
            </button>
            <button id="mode-insert" class="mode-btn" onclick="window.ScanCtrl.setMode('insert')">
                <i class="fas fa-plus fa-2x" style="color:#f59e0b;"></i> Neu
            </button>
        </div>

        <div id="price-results"></div>
    </div>

    <%- include('partials/match_modals') %>
    
    <div id="sell-modal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
        <div class="modal-box" style="background:#1e293b; padding:20px; border-radius:10px; text-align:center; width:90%; color:white;">
            <h2 style="color:#ef4444;">Verkauf buchen?</h2>
            <div id="sell-preview" style="text-align:left; margin:15px 0; color:#cbd5e1;"></div>
            <button id="btn-confirm-sell" style="background:#ef4444; color:white; border:none; padding:10px 30px; border-radius:5px; font-weight:bold;">JA, VERKAUFEN</button>
            <button onclick="document.getElementById('sell-modal').style.display='none'" style="background:transparent; color:white; border:1px solid #555; padding:10px 20px; border-radius:5px; margin-left:10px;">Abbrechen</button>
        </div>
    </div>

    <div id="crop-modal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:10000;">
        <div style="height:90vh;">
             <img id="image-to-crop" style="max-width:100%;">
        </div>
        <button id="btn-ocr-confirm" onclick="window.ScanCtrl.performOCRUpload()" style="position:absolute; bottom:20px; right:20px; background:#3b82f6; color:white; padding:15px; border:none; border-radius:8px;">Scan OK</button>
        <button onclick="document.getElementById('crop-modal').style.display='none'" style="position:absolute; top:20px; right:20px; background:none; color:white; font-size:2rem; border:none;">&times;</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <script src="/js/lager/view.js"></script>
    <script src="/js/lager/scanner.js"></script>
    <script src="/js/lager/workflow-sell.js"></script>
    <script src="/js/lager/workflow-inventory.js"></script>
    <script src="/js/lager/workflow-search.js"></script>
    <script src="/js/lager/controller-core.js"></script>
    <script src="/js/lager/controller-search.js"></script>
    <script src="/js/lager/controller-match.js"></script>
    <script src="/js/lager/controller-scan.js"></script>

    <script src="/js/terminal_main.js"></script>

</body>
</html>